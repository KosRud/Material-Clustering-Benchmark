<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Material Clustering Benchmark: Data Layout</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js", "amsmath.js", "amssymb.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
MathJax.Hub.Config({
    TeX: { equationNumbers: { autoNumber: "AMS" } },
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="Style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Material Clustering Benchmark
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md__assets__documentation__data__layout.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Data Layout </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md0">Array Texture</a><ul><li class="level2"><a href="#color-representation">Color representation</a><ul><li class="level3"><a href="#autotoc_md1">Code</a></li>
</ul>
</li>
<li class="level2"><a href="#noise-flag">Noisy pixels</a><ul><li class="level3"><a href="#autotoc_md2">Code</a></li>
</ul>
</li>
<li class="level2"><a href="#third-component">Third component</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md3">Compute Buffer</a></li>
<li class="level1"><a href="#autotoc_md4">References</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="autotoc_md0"></a>
Array Texture</h1>
<p >Inside the array texture <a class="el" href="class_clustering_textures.html#abc318fc164bf513d67908878f4b2701f">ClusteringTextures.rtArr</a> the following data layout is used:</p>
<p class="formulaDsp">
\begin{equation}
\begin{aligned}
    \boldsymbol{T}_k(\delta)       &amp; = \begin{bmatrix}
        \tilde{C}_2(\delta) w(\delta,k) f(\delta) \\
        \tilde{C}_3(\delta) w(\delta,k) f(\delta) \\
        z_k(\delta) \\
        w(\delta,k) f(\delta)
    \end{bmatrix}
\end{aligned}
\end{equation}
</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Variable   </th><th class="markdownTableHeadNone">Explanation    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">\(\boldsymbol{T}_k\)   </td><td class="markdownTableBodyNone">4-component floating point texture corresponding to \(k\)-th cluster    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">\(\delta\)   </td><td class="markdownTableBodyNone">pixel    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">\(\boldsymbol{\tilde{C}}(\delta)\)   </td><td class="markdownTableBodyNone"><a class="el" href="md__assets__documentation__data__layout.html#color-representation">color representation</a> used for material clustering    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">\(w(\delta,k)\)   </td><td class="markdownTableBodyNone">weight of \(k\)-th cluster for the pixel \(\delta\) (1 or 0 in the case of K-Means)<sup>&lowast;</sup>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">\(f(\delta)\)   </td><td class="markdownTableBodyNone"><a class="el" href="md__assets__documentation__data__layout.html#noise-flag">binary flag</a> which determines if the pixel is rejected as noise    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">\(z_k(\delta)\)   </td><td class="markdownTableBodyNone">used for storing MSE (<a class="el" href="md__assets__documentation__data__layout.html#third-component">see below</a>)   </td></tr>
</table>
<p ><sup>&lowast;</sup> For <a class="el" href="class_clustering_algorithms_1_1_dispatcher_k_h_mp.html">KHMp</a> algorithm, weights \(w(\delta,k)\) for the given pixel do not add up to 1.</p>
<h2><a class="anchor" id="color-representation"></a>
Color representation</h2>
<p >Color representation \(\boldsymbol{\tilde{C}}(\delta)\) is generated from the RGB color of pixel \(\delta\) as follows:</p>
<ol type="1">
<li>maximize HSI saturation (intensity becomes invalid) <p class="formulaDsp">
\begin{equation}
    \dot{\boldsymbol{C}} (\delta) = \boldsymbol{C}(\delta) - (1,1,1)^T \cdot \min\limits_{i \in \lbrace\mathrm{R,G,B}\rbrace}C_i(\delta)
\end{equation}
</p>
</li>
<li>normalize HSI intensity to \(\frac{1}{3}\) <p class="formulaDsp">
\begin{equation}
\ddot{\boldsymbol{C}} (\delta) = \frac{
    \dot{\boldsymbol{C}} (\delta)
}{
    \Vert \dot{\boldsymbol{C}} (\delta) \Vert_1
}
\end{equation}
</p>
</li>
<li>convert from RGB to I<sub>1</sub>,I<sub>2</sub>,I<sub>3</sub> color space [1,2] <p class="formulaDsp">
\begin{equation}
\boldsymbol{\tilde{C}} = \begin{bmatrix}
    \phantom{-}\frac{1}{3}\hspace{10px}\phantom{-}  &amp; \frac{1}{3}\hspace{10px}  &amp; \phantom{-}\frac{1}{3} \\[4pt]
    \phantom{-}\frac{1}{2}\hspace{10px}\phantom{-}  &amp; 0\hspace{10px}            &amp; -\frac{1}{2} \\[4px]
    -\frac{1}{4}\hspace{10px}\phantom{-}            &amp; \frac{1}{2}\hspace{10px}  &amp; -\frac{1}{4}
\end{bmatrix} \cdot \ddot{\boldsymbol{C}} (\delta)
\end{equation}
</p>
</li>
</ol>
<h3><a class="anchor" id="autotoc_md1"></a>
Code</h3>
<div class="fragment"><div class="line">float2 project(float3 col)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* </span></div>
<div class="line"><span class="comment">        maximize HSI saturation</span></div>
<div class="line"><span class="comment">        intensity becomes invalid</span></div>
<div class="line"><span class="comment">    */</span></div>
<div class="line">    col -= min(</div>
<div class="line">        col.r,</div>
<div class="line">        min(</div>
<div class="line">            col.g,</div>
<div class="line">            col.b</div>
<div class="line">        )</div>
<div class="line">    );</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/*</span></div>
<div class="line"><span class="comment">        normalize HSI intensity</span></div>
<div class="line"><span class="comment">        </span></div>
<div class="line"><span class="comment">        this creates potential division by zero</span></div>
<div class="line"><span class="comment">        erroneous pixels will be rejected due to is_color_valid() check</span></div>
<div class="line"><span class="comment">    */</span></div>
<div class="line">    col /= dot(col, 1);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// transform to I1,I2,I3 color space</span></div>
<div class="line">    col = mul(rgb_2_iii_matrix,col);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// return chromaticity axes, ignore intensity</span></div>
<div class="line">    <span class="keywordflow">return</span> col.gb;</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="noise-flag"></a>
Noisy pixels</h2>
<p >When HSI intensity and/or saturation is low, the hue becomes unstable. Such pixels will be ignored during clustering by setting \(f(\delta)=0\). The value of \(f(\delta)\) for the given RGB color is determined as follows:</p>
<p class="formulaDsp">
\begin{equation}
f(\delta) = \begin{cases}
    1, &amp; \text{if} \quad \left\Vert \boldsymbol{C}(\delta) - (1,1,1)^T \cdot \min\limits_{i \in \lbrace\mathrm{R,G,B}\rbrace}C_i(\delta) \right\Vert_1 \geq t \\
    0 &amp; \text{otherwise}
    \end{cases}
\end{equation}
</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Variable   </th><th class="markdownTableHeadNone">Explanation    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">\(\boldsymbol{C}(\delta)\)   </td><td class="markdownTableBodyNone">RGB color of pixel \(\delta\)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">\(t\)   </td><td class="markdownTableBodyNone">threshold for determining noisy pixels (we used \(t=0.05\))   </td></tr>
</table>
<h3><a class="anchor" id="autotoc_md2"></a>
Code</h3>
<div class="fragment"><div class="line"><span class="preprocessor">#define valid_threshold 0.05</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">bool</span> is_color_valid(float3 col) {</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// subtract achromatic portion</span></div>
<div class="line">    col -= min(</div>
<div class="line">        col.r,</div>
<div class="line">        min(</div>
<div class="line">            col.g,</div>
<div class="line">            col.b</div>
<div class="line">        )</div>
<div class="line">    );</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> dot(col, 1) &gt; valid_threshold;</div>
<div class="line">}</div>
</div><!-- fragment --><p >After the clustering is completed, noisy pixels are assigned to the nearest cluster. Reported MSE measurements ignore the noisy pixels.</p>
<h2><a class="anchor" id="third-component"></a>
Third component</h2>
<p >The third component \(z_k(\delta)\) has different values in different \(\boldsymbol{T}_k\) textures:</p>
<p class="formulaDsp">
\begin{equation}
z_k(\delta) =
    \begin{cases}
    d_\mathrm{min}(\delta)^2 f(\delta) &amp; \text{first texture } (k=1) \\
    f(\delta), &amp; \text{second texture } (k=2) \\
    0 &amp; \text{remaining textures}
    \end{cases}
\end{equation}
</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Variable   </th><th class="markdownTableHeadNone">Explanation    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">\(d_\mathrm{min}(\delta)\)   </td><td class="markdownTableBodyNone">Euclidean distance between the color \(\tilde{C}_2(\delta),\tilde{C}_3(\delta)\) and the nearest cluster center    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">\(f(\delta)\)   </td><td class="markdownTableBodyNone"><a class="el" href="md__assets__documentation__data__layout.html#noise-flag">binary flag</a> which determines if the pixel is rejected as noise   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md3"></a>
Compute Buffer</h1>
<p >Inside the <a class="el" href="class_clustering_algorithms_1_1_clustering_r_ts_and_buffers.html#a76221a02ff6d0e0d6146ccc3ec9188be">compute buffer</a>, the following data layout is used:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Component   </th><th class="markdownTableHeadNone">Value    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>x,y</code>   </td><td class="markdownTableBodyNone">cluster center (see <a class="el" href="md__assets__documentation__data__layout.html#color-representation">color representation</a>)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>z</code>   </td><td class="markdownTableBodyNone">MSE (or -1, if MSE can not be computed)<sup>&lowast;</sup>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>w</code>   </td><td class="markdownTableBodyNone">1 if cluster is not empty, 0 otherwise   </td></tr>
</table>
<p ><sup>&lowast;</sup>If all pixels in the frame are <a class="el" href="md__assets__documentation__data__layout.html#noise-flag">rejected as noise</a> (i.e. \(f(\delta)=0\) for every \(\delta\)), MSE can not be computed.</p>
<h1><a class="anchor" id="autotoc_md4"></a>
References</h1>
<ol type="1">
<li>Kahu, S.Y., Raut, R.B., Bhurchandi, K.M.: Review and evaluation of color spaces for image/video compression. Color Research &amp; Application 44(1), 8–33 (2019) \(\label{ref1}\)</li>
<li>Ohta, Y.I., Kanade, T., Sakai, T.: Color information for region segmentation. Computer graphics and image processing 13(3), 222–241 (1980) </li>
</ol>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4 </li>
  </ul>
</div>
</body>
</html>
